# Gem5-ex3 - McPAT

# 1ο Βήμα - Εξοικείωση με τον εξιμοιωτή McPAT

Το McPAT αποτελεί έναν προσομοιωτή ενέργειας, χώρου, και χρονισμού για πολυνηματικές και πολυπύρηνες αρχιτεκτονικές. Περιλαμβάνει τα μοντέλα επεξεργαστών, το δίκτυο επικοινωνίας, την κοινόχρηστη κρυφή μνήμη Cache και τους ελεγκτές μνήμης μπορώντας έτσι να εξάγει συμπεράσματα για τον χρονισμό, τον έκταση του επεξεργαστή, την κατανάλωση ενέργειας για διάφορες τεχνολογίες από 90nm μέχρι 20nm.

- Πηγή [HP - McPAT](https://www.hpl.hp.com/research/mcpat/)

Clone github McPat

``` git clone https://github.com/kingmouf/cmcpat.git my_mcpat ```

*Πιθανόν χρειάζονται τα παρακάτω πακέτα*
- ```sudo apt install libc6-dev-i386``` για 32bit  ή ```sudo apt-get install g++-multilib``` για 64bit
- ```sudo apt install gcc-7-multilib g++-7-multilib```

Compile with make

- ```cd my_mcpat/mcpat```
- ```make```

Εκτέλεση του McPAT για τον επεξεργαστή *Xeon* από το φάκελο ProcessorDescriptionFiles
- ```./mcpat -infile ProcessorDescriptionFiles/Xeon.xml -print_level 1```
*-print_level 1,2,3,4,5*

## Ερώτημα 1ο

### Αποτελέσματα της προσομοίωσης με τον McPAT [Xeon - McPAT](/src/McPAT_output/Xeon.txt)

- Τεχνολογια Τρανζίστορ : [65nm](/src/McPAT/Xeon.txt#L6)

**Κατανάλωση Ισχύος**
- Peak Power            : [134.938 W](/src/McPAT_output/Xeon.txt#L14)
- Total Leakage         : [36.8319 W](/src/McPAT_output/Xeon.txt#L15)
  - Subthreshold Leakage  : [35.1632 W](/src/McPAT_output/Xeon.txt#L17)
  - Gate Leakage          : [1.66871 W](/src/McPAT_output/Xeon.txt#L19)
- Peak Dynamic          : [98.1063 W](/src/McPAT_output/Xeon.txt#L16)
  - Runtime Dynamic     : [72.9199 W](/src/McPAT_output/Xeon.txt#L20)

### Επεξήγηση των όρων Dynamic Power και Leakage Power

Η Κατανάλωση Ισχύος σε ένα ολοκληρωμένο κυκλωμα χωρίζεται σε 2 κατηγορίες. Την στατική κατανάλωση ισχύος (Static Power dissipation ή Power Leakage) και την δυναμική κατανάλωση ισχύος (Dynamic power dissipation). Την ενέργεια αυτή απορροφά κάθε διακόπτης για να αλλάξει ή για να διατηρήσει την κατάσταση που βρίσκεται (on ή off).

Η **στατική κατανάλωση** ισχύος αναφέρεται στην ισχύ που καταναλώνει ένας διακόπτης/τρανζίστορ για να βρίσκεται σε λειτουργία. Θεωρητικά εντοπίζεται ροή ρεύματος μόνο μεταξύ της πηγής και του εκπομπού του τρανζίστορ. Όμως στην πράξη, υπάρχουν μικρά ρεύματα από την πύλη (Gate leakage) και το υπόστρωμα (Subthreshold leakage) που απορροφούν ενέργεια *ανάλογη της τάσης τροφοδοσίας, της τάσης κατωφλίου και του λόγου W/L* δηλαδή των μεγεθών του τρανζίστορ. Η ισχύς αυτή καταναλώνεται ακόμα και στην αλλαγή της κατάστασης του διακόπτη και για αυτό ονομάζεται Στατική.  

Η **Δυναμική Κατανάλωση** ισχύος εντοπίζεται κατά την αλλαγή της κατάστασης του αντιστροφέα και οφείλεται στην ύπαρξη ροής ρεύματος διαμέσου του διακόπτη για την φόρτιση και εκφόρτιση του χωρητικού φορτίου αλλά και ρεύματα βραχυκύκλωσης διαμέσου των τρανζίστορ του διακόπτη. Αυτά τα ρεύματα αναγκάζουν τους διακόπτες να καταναλώνουν ισχύ που ονομάζεται Δυναμική κατανάλωση Ισχύος. Αυτή η ισχύς αυξάνεται με την αύξηση της συχνότητας του ρολογιού, την τάση τροφοδοσίας και της χωρητικότητας του τρανζίστορ. Η νέες τεχνολογίες μικραίνουν την τάση τροφοδοσίας αλλά η απαιτήσεις για μεγάλη συχνότητα μπορούν να αυξήσουν την ισχύ αυτή σημαντικά.

- Πηγές
  - *Sedra, A.S. & Smith, K.C. (1982) Mircoelectronic Circuits, Seven Edition*
  - *[Semiconductor Engineering](https://semiengineering.com/knowledge_centers/low-power/low-power-design/power-consumption/)*

### Πως ένα πρόγραμμα επηρεάζει την Κατανάλωση Ισχύος

Η Δυναμική Κατανάλωση Ισχύος (Dynamic Power) και η Στατική Κατανάλωση Ισχύος (Leakage Power) επηρεάζονται διαφορετικά από την συμπεριφορά του συστήματος. Η Στατική Ισχύς απαιτείται είτε το σύστημα βρίσκεται σε χρήση είτε σε αναμονή. Αντίθετα το Dynamic Power απαιτείται μόνο κατά την χρήση των ολοκληρωμένων στο σύστημα ενώ σε κατάσταση αναμονής δεν υπάρχει δυναμική κατανάλωση Ισχύος.

Επομένως ένα πρόγραμμα επηρεάζει μόνο το Dynamic Power του συστήματος. Η κατανάλωση αυτή μπορεί να μειωθεί με την χρήση εντολών που απαιτούν μικρότερο αριθμό κύκλων και κατά επέκταση μικρότερη συχνότητα λειτουργίας ή με την παράλληλοποίηση του προγράμματος σε πολυπύρηνα συστήματα. Επιπλέον σημαντικός παράγοντας κατανάλωσης ενέργειας είναι οι προσπελάσεις στην μνήμη ενός προγράμματος. Σε κάθε αναζήτηση ενεργοποιούνται οι διακόπτες των ολοκληρωμένων της μνήμης με αποτέλεσμα να έχουμε μεγάλη κατανάλωση ισχύος και αύξηση του Dynamic Power.

Η χρονική διάρκεια του προγράμματος, δεδομένου ότι το σύστημα εκτελεί μόνο αυτό και τερματίζει επηρεάζει το Leakage Power. Σε όλη την διάρκεια που το σύστημα είναι ενεργοποιημένο, ανεξάρτητα από το ποσοστό χρήσης του καταναλώνει ενέργεια, με αποτέλεσμα τα προγράμματα με μεγαλύτερη διάρκεια να αυξάνουν την Στατική Κατανάλωση Ισχύος.


## Ερώτημα 2ο

### Energy Efficiency - Ενεργειακή Αποδοτικότητα

Η **Ενεργειακή Αποδοτικότητα** είναι ο αριθμός των λειτουργιών που εκτελεί ένα σύστημα προς την ισχύ που καταναλώνει. Ο όρος αυτός είναι το μέτρο σύγκρισης των συστημάτων με διαφορετική υπολογιστική ισχύ και κατανάλωση.

Επομένως γνωρίζοντας μόνο την κατανάλωση των 2 επεξεργαστών δεν μπορούμε να συμπεράνουμε ποιος είναι κατάλληλος για την χρήση του στο σύστημα αυτό αλλά χρειαζόμαστε και τον αριθμό των λειτουργιών που εκτελεί ο επεξεργαστής ανά μονάδα Watt. Υπάρχει περίπτωση ο πρώτος επεξεργαστής να εκτελεί περίπου 0.5 operations Per Watt  και ο δεύτερος 4 operations Per Watt. Άρα για ένα πρόγραμμα 100 operations ο πρώτος θα καταναλώσει 200Watt ενώ ο δεύτερος 25Watt !

Το μοντέλο του ma
